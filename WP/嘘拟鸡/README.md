# 嘘拟鸡

> 本来还要加点混淆的，因为没时间所以直接上了，难度没有很高，逻辑挺清晰的。

跟进enc函数中，先分析作用

|        |           |
| ------ | --------- |
| Fun_1  | 二进制加法     |
| Fun_2  | 二进制减法     |
| Fun_3  | 二进制乘法     |
| Fun_4  | Push      |
| Fun_5  | Pop       |
| Fun_6  | 汇编指令add   |
| Fun_7  | 汇编指令sub   |
| Fun_8  | 汇编指令xor   |
| Fun_9  | 汇编指令mul   |
| Fun_10 | 汇编指令and   |
| Fun_11 | Opcode值   |
| Fun_12 | key值      |
| Fun_13 | 输出值output |
| Fun_14 | 密文        |

Opcode为

```Plain
.data:0000000000404020 00 11 00 12 00 41 00 13 16 13+dw 1100h, 1200h, 4100h, 1300h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2100h.data:0000000000404020 00 31 FF 13 00 91 05 21 06 11+dw 1101h, 1201h, 4100h, 1301h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2101h.data:0000000000404020 06 12 00 41 06 13 16 13 00 51+dw 1102h, 1202h, 4100h, 1302h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2102h.data:0000000000404020 00 41 11 13 00 61 0B 13 00 31+dw 1103h, 1203h, 4100h, 1303h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2103h.data:0000000000404020 FF 13 00 91 06 21 07 11 07 12+dw 1104h, 1204h, 4100h, 1304h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2104h.data:0000000000404020 00 41 07 13 16 13 00 51 00 41+dw 1105h, 1205h, 4100h, 1305h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2105h.data:0000000000404020 11 13 00 61 0B 13 00 31 FF 13+dw 1106h, 1206h, 4100h, 1306h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2106h.data:0000000000404020 00 91 07 21 08 11 08 12 00 41+dw 1107h, 1207h, 4100h, 1307h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2107h.data:0000000000404020 08 13 16 13 00 51 00 41 11 13+dw 1108h, 1208h, 4100h, 1308h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2108h.data:0000000000404020 00 61 0B 13 00 31 FF 13 00 91+dw 1109h, 1209h, 4100h, 1309h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2109h.data:0000000000404020 08 21 09 11 09 12 00 41 09 13+dw 110Ah, 120Ah, 4100h, 130Ah, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 210Ah.data:0000000000404020 16 13 00 51 00 41 11 13 00 61+dw 110Bh, 120Bh, 4100h, 130Bh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 210Bh.data:0000000000404020 0B 13 00 31 FF 13 00 91 09 21+dw 110Ch, 120Ch, 4100h, 130Ch, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 210Ch.data:0000000000404020 0A 11 0A 12 00 41 0A 13 16 13+dw 110Dh, 120Dh, 4100h, 130Dh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 210Dh.data:0000000000404020 00 51 00 41 11 13 00 61 0B 13+dw 110Eh, 120Eh, 4100h, 130Eh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 210Eh.data:0000000000404020 00 31 FF 13 00 91 0A 21 0B 11+dw 110Fh, 120Fh, 4100h, 130Fh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 210Fh.data:0000000000404020 0B 12 00 41 0B 13 16 13 00 51+dw 1110h, 1210h, 4100h, 1310h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2110h.data:0000000000404020 00 41 11 13 00 61 0B 13 00 31+dw 1111h, 1211h, 4100h, 1311h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2111h.data:0000000000404020 FF 13 00 91 0B 21 0C 11 0C 12+dw 1112h, 1212h, 4100h, 1312h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2112h.data:0000000000404020 00 41 0C 13 16 13 00 51 00 41+dw 1113h, 1213h, 4100h, 1313h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2113h.data:0000000000404020 11 13 00 61 0B 13 00 31 FF 13+dw 1114h, 1214h, 4100h, 1314h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2114h.data:0000000000404020 00 91 0C 21 0D 11 0D 12 00 41+dw 1115h, 1215h, 4100h, 1315h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2115h.data:0000000000404020 0D 13 16 13 00 51 00 41 11 13+dw 1116h, 1216h, 4100h, 2 dup(1316h), 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2116h.data:0000000000404020 00 61 0B 13 00 31 FF 13 00 91+dw 1117h, 1217h, 4100h, 1317h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2117h.data:0000000000404020 0D 21 0E 11 0E 12 00 41 0E 13+dw 1118h, 1218h, 4100h, 1318h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2118h.data:0000000000404020 16 13 00 51 00 41 11 13 00 61+dw 1119h, 1219h, 4100h, 1319h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2119h.data:0000000000404020 0B 13 00 31 FF 13 00 91 0E 21+dw 111Ah, 121Ah, 4100h, 131Ah, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 211Ah.data:0000000000404020 0F 11 0F 12 00 41 0F 13 16 13+dw 111Bh, 121Bh, 4100h, 131Bh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 211Bh.data:0000000000404020 00 51 00 41 11 13 00 61 0B 13+dw 111Ch, 121Ch, 4100h, 131Ch, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 211Ch.data:0000000000404020 00 31 FF 13 00 91 0F 21 10 11+dw 111Dh, 121Dh, 4100h, 131Dh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 211Dh.data:0000000000404020 10 12 00 41 10 13 16 13 00 51+dw 111Eh, 121Eh, 4100h, 131Eh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 211Eh.data:0000000000404020 00 41 11 13 00 61 0B 13 00 31+dw 111Fh, 121Fh, 4100h, 131Fh, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 211Fh.data:0000000000404020 FF 13 00 91 10 21 11 11 11 12+dw 1120h, 1220h, 4100h, 1320h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2120h.data:0000000000404020 00 41 11 13 16 13 00 51 00 41+dw 1121h, 1221h, 4100h, 1321h, 1316h, 5100h, 4100h, 1311h, 6100h, 130Bh, 3100h, 13FFh, 9100h, 2121h.data:0000000000404020 11 13 00 61 0B 13 00 31 FF 13+dw 0A000h, 3 dup(0)
```

通过每位上的数字进行判断，

#define PUSH 0x1000

#define POP 0x2000

#define ADD 0x5000

#define SUB 0x3000

#define XOR 0x4000

#define MUL 0x6000

#define AND 0x9000

#define RET 0xA000

这里因为没写cmp和jmp，所以通过opcode手动进行了长达33次的循环计算。

这里分析第一行即可理解全部，

```Plain
Push key[0]push input[0]xor stack[0],stack[0]Push 0(for i in range（len（input）中的i)Push 0x16Add 0+0x16Xor  stack[0],0x16Push 0x11Mul stack[0],0x11Push 0xbSub stack[0],0xbPush 0xffAnd stack[0],0xffPop stack[0]
```

密文为

```Python
 0x28, 0x5B, 0x34, 0x28, 0xC0, 0x24, 0x13, 0x46, 0xBA, 0xAF,   0x6B, 0xC1, 0xED, 0xCF, 0x59, 0x7A, 0x98, 0x16, 0xC0, 0x65,   0x26, 0xE2, 0x48, 0xCF, 0x6A, 0x24, 0x37, 0x5B, 0x66, 0xD2,   0x14, 0x42, 0xFE, 0x10
```

解密代码

```Python
import gmpy2d=gmpy2.invert(17,256)print(d)key=b"ch4ng_t14o_r4p_d4_l4n_qiu_zh1_y1n!"x=[40, 91, 52, 40, 192, 36, 19, 70, 186, 175, 107, 193, 237, 207, 89, 122, 152, 22, 192, 101, 38, 226, 72, 207, 106, 36, 55, 91, 102, 210, 20, 66, 254, 16]for i in range(len(x)):    x[i] = (d * (x[i]+11))^i+22    x[i]=x[i]&0xff    x[i]^=key[i]    print(chr(x[i]),end="")
```
